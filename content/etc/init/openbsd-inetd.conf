start on started xbmc-done
stop on runlevel [06]

expect fork

env DAEMON=/usr/sbin/inetd

pre-start script
    [ -x $DAEMON -a -e /etc/inetd.conf ] || { stop; exit 0; }

    if [ ! -d /var/run/sshd ]; then
        mkdir -p /var/run/sshd
        chmod 0755 /var/run/sshd
    fi
end script

script
    [ ! -e /etc/default/openbsd-inetd ] || . /etc/default/openbsd-inetd
    exec $DAEMON $OPTIONS
end script

post-start script
    [ ! -x /etc/usbmount/mount.d/00-clean ] || /etc/usbmount/mount.d/00-clean || :
    for s in $(net conf listshares); do 
        mountpoint -q $(net conf showshare $s | grep "path =" | awk -F'=' '{print $2}') \
            || net conf delshare $s || :
    done
end script

